
function formQuery(){this.init=function(_self){$("#regionul").find("a").each(function(){$(this).click(function(){var idvalue=$(this).parent().attr("id");var region=idvalue.match(/[1-9][0-9]*/g);if(region.length>0){_self.region=region[0];_self.submit();$("#regionul").find(".active").removeClass("active");$(this).parent().addClass("active");}});});$(".searchButton").click(function(){_self.name=$('#searchKeyword').val();_self.submit();});$("#statusul").find("a").each(function(){$(this).click(function(){var idvalue=$(this).parent().attr("id");var status=idvalue.match(/[0-9][0-9]*/g);if(status.length>0){_self.status=status[0];_self.submit();$("#statusul").find(".active").removeClass("active");$(this).parent().addClass("active");}});});$("#useul").find("a").each(function(){$(this).click(function(){var idvalue=$(this).parent().attr("id");var use=idvalue.match(/[0-9][0-9]*/g);if(use.length>0){_self.use=use[0];_self.submit();$("#useul").find(".active").removeClass("active");$(this).parent().addClass("active");}});});$("#pageNext").click(function(){_self.setPageIndex(_self.index+1);_self.submit();});$("#pagePre").click(function(){_self.setPageIndex(_self.index-1);_self.submit();});$("#pageBegin").click(function(){_self.setPageIndex(0);_self.submit();});$("#pageEnd").click(function(){_self.setPageIndex(_self.pageCount-1);_self.submit();});var region=getUrlParam("region");if(region){_self.region=region;if(region.length>4){region=region.substr(0,4);}
$("#regionul").find(".active").removeClass("active");$("#regionul").find("#region"+region).addClass("active");}};this.setPageIndex=function(index){this.index=index;};this.setPageCount=function(count){this.pageCount=count;};this.getQueryData=function(){var param={};if(this.region){param.region=this.region;}
if(this.name){param.name=this.name;}
if(this.status){param.status=this.status;}
if(this.use){param.use=this.use;}
if(this.index){param.page=this.index;}
return param;};this.submit=function(){BeginQueryResourceList(this.getQueryData());};}
var _dayLength=24*60*60*1000;var _hourLength=60*60*1000;var _minLength=60*1000;var _serverTime;var _formQuery=new formQuery();$(document).ready(function(){var beginGetDate=(new XDate()).valueOf()*1.0;$.ajax({type:"GET",url:"./time",cache:false,success:function(data){var endGetDate=(new XDate()).valueOf()*1.0;_serverTime=data*1.0+endGetDate-beginGetDate;$("#serverTimeSpan").html(formateTime(_serverTime));},complete:function(XMLHttpRequest,status){if(status=='timeout'){}else if(status=='error'){}}});setInterval(function(){_serverTime=_serverTime+1000;$("#serverTimeSpan").html(formateTime(_serverTime));},1000);_formQuery.init(_formQuery);BeginQueryResourceList(_formQuery.getQueryData());});function BeginQueryResourceList(param){$.ajax({type:"GET",url:"./list",cache:false,data:param,success:function(result){var data=result.data;if(data){var gettpl=$("#resourceInfo").html();laytpl(gettpl).render(data,function(html){$("#resourceList").html(html);timeDownAndUp();});}
updatePageInfo(result);}});}
function timeDownAndUp(){timeUp();setInterval(timeUp,1000);timeDown();setInterval(timeDown,1000);}
function timeUp(){$(".timeUp").each(function(){var value=$(this).attr("value")*1.0;$(this).html(setTimeString(_serverTime-value));});}
function timeDown(){$(".spanTimeDown").each(function(){var value=$(this).attr("value")*1.0;$(this).html(setTimeString(value-_serverTime));});}
function updatePageInfo(data){var cPage=data.condition.page+1;var pageCount=data.pageCount;if(pageCount==0)pageCount=1;$("#pageCurrent").html(cPage);$("#pageCount").html(pageCount);_formQuery.setPageIndex(data.condition.page);_formQuery.setPageCount(pageCount);if(cPage==1){$("#pagePre").attr("disabled",true);$("#pageBegin").attr("disabled",true);}else{$("#pagePre").attr("disabled",false);$("#pageBegin").attr("disabled",false);}
if(cPage==pageCount){$("#pageNext").attr("disabled",true);$("#pageEnd").attr("disabled",true);}else{$("#pageNext").attr("disabled",false);$("#pageEnd").attr("disabled",false);}}
function formateTime(dateTime){var serverTimeObj=new XDate(_serverTime*1.0);return serverTimeObj.toString("yyyy年MM月dd日 HH:mm:ss");}
function getUrlParam(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(reg);if(r!=null)return unescape(r[2]);return null;}
function convertToDateLongValue(dateString){return XDate.parse(dateString);}
function setTimeString(diffvalue){var days=(diffvalue)/_dayLength;var hours=((diffvalue)%_dayLength)/_hourLength;var min=(((diffvalue)%_dayLength)%_hourLength)/_minLength;var sec=(((diffvalue)%_dayLength)%_hourLength)%_minLength/1000;if(days>1)
return buildTimeStr(days)+"<em>天</em>"+buildTimeStr(hours)+"<em>时</em>"+buildTimeStr(min)+"<em>分</em>"+buildTimeStr(sec)+"<em>秒</em>";else if(hours>1)
return buildTimeStr(hours)+"<em>时</em>"+buildTimeStr(min)+"<em>分</em>"+buildTimeStr(sec)+"<em>秒</em>";else if(min>1)
return buildTimeStr(min)+"<em>分</em>"+buildTimeStr(sec)+"<em>秒</em>";else if(sec>0)
return buildTimeStr(sec)+"<em>秒</em>";}
function buildTimeStr(value){value=Math.floor(value*1.0);if(value>9){return"<var>"+value+"</var>";}else{return"<var>0"+value+"</var>";}}
function addFavorite(){if(document.all){window.external.addFavorite("http://www.landjs.com","江苏土地市场网");}else if(window.sidebar){window.sidebar.addPanel('江苏土地市场网','http://www.landjs.com','');}else{alert("抱歉，您所使用的浏览器无法完成此操作。\n\n加入收藏失败，请使用Ctrl+D进行添加");}
return false;}